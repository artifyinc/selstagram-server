FROM python:3.4.6
MAINTAINER Yoonje Choi <yoonjechoi@gmail.com>

ENV PYTHONUNBUFFERED 1
ENV USERNAME selstagram


#RUN
RUN apt-get update


RUN adduser --disabled-password --gecos '' ${USERNAME}
RUN su ${USERNAME}



RUN git clone https://github.com/pyenv/pyenv.git ~/.pyenv

RUN mkdir /git-repo
WORKDIR /git-repo
RUN git clone https://github.com/artifyinc/selstagram-server
RUN pip install -r /config/requirements.txt

# nginx
RUN apt-get install -y nginx
ADD nginx/selstagram-server /etc/nginx/sites-available/selstagram-server
RUN ln -s /etc/nginx/sites-available/selstagram-server /etc/nginx/sites-enabled/
RUN rm /etc/nginx/sites-enabled/default
RUN echo "\ndaemon off;" >> /etc/nginx/nginx.conf
RUN chown -R www-data:www-data /var/lib/nginx



# create unprivileged user

#

#RUN apt-get install -y supervisor
#ADD ./conf/supervisord.conf /etc/supervisor/conf.d/supervisord.conf

# uWSGI
RUN pip install uwsgi
ADD nginx/selstagram.ini /etc/uwsgi/sites/selstagram.ini

#CMD ["/usr/bin/supervisord"]

EXPOSE 80
EXPOSE 443

PUBLISH 80
PUBLISH 443